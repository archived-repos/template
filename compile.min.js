/*! jstool-compile 2015-04-25 */
!function(a,b){"use strict";"undefined"==typeof a?"undefined"!=typeof module&&(module.exports=b()):void 0!==a.define?a.define("compile",b):void 0!==a.fn?a.fn.define("compile",b):a.compile||(a.compile=b())}(this,function(){"use strict";function a(a){return function(b){return b instanceof a}}function b(a){return"string"==typeof a}function c(a){if(!b(a))throw"template should be a string";var c=a.split(h),e=[c.shift()];a.replace(i,function(a,b,d,f,g,h){e.push(g?{cmd:"",expression:"/"}:h?{cmd:"",expression:"else"}:{cmd:d,expression:f}),e.push(c.shift())});var f=d("root",!1,e);return f}function d(a,b,c){a=(a||"").trim(),b=(b||"").trim();for(var e={content:[]},g="content",h=[e.content],i=function(a){e[a]=[],g=a,h.push(e[a])},j=c.shift();void 0!==j;){if("string"==typeof j)e[g].push(j);else if(m(j))if(j.cmd)switch(j.cmd){case"i18n":e[g].push(new f(j.cmd,j.expression.replace(/\/$/,"")));break;case"case":case"when":i(j.expression);break;default:e[g].push("/"===j.expression.substr(-1)?new f(j.cmd,j.expression.replace(/\/$/,"")):d(j.cmd,j.expression,c))}else switch(j.expression){case"else":case"otherwise":i("otherwise");break;case"/":return new f(a,b,e,h);default:e[g].push(new f("var",j.expression))}j=c.shift()}return"root"!==a&&console.log("something wrong in script"),new f(a,b,e,h)}function e(a,b){return b=b||{},/^[^\s\.]+$/.test(a)?b[a]||"":j(a)(b)}function f(a,b,c,d){this.cmd=a,this.options=c||{},this.options.args=b.split(","),this.list=d||[]}var g={},h=/\$[\w\?]*{[^\}]+}|{\$}|{\:}/,i=/(\$([\w\?]*){([^\}]+)})|({\$})|({\:})/g,j=function(a){return new Function("model","try{ with(model) { return ("+a+") }; } catch(err) { return ''; }")},k=a(Function),l=a(Array),m=a(Object);return c.cmd=function(a,c,d){b(a)&&k(c)&&(g[a]=c,c.$$autoParse=void 0===d?!0:d)},c._run=function(a,d){var e="";return a.forEach(function(a){b(a)?e+=a:a instanceof f?e+=a.render(d):l(a)&&(e+=c._run(a,d))}),e},g.root=function(){return this.content},g["var"]=function(a){return m(a)?"":a||""},g["if"]=function(a){return a?this.content:this.otherwise||""},g["?"]=g["if"],["root","var","if","?"].forEach(function(a){g[a].$$autoParse=!0}),f.prototype.render=function(a){var b,d=this;if(this.scope=a,!k(g[d.cmd]))return"[command "+d.cmd+" not found]";var f=d.options.args;return d.options.scope=a,g[d.cmd].$$autoParse&&(f=[],d.options.args.forEach(function(b){f.push(b?e(b,a):"")})),b=g[this.cmd].apply(d.options,f),l(b)?c._run(b,a):"string"==typeof b?b:""+b},c.cmd("each",function(a){var b="";return l(a)&&a.forEach(function(a){b+=c._run(this.content,a)}),b}),function(a){var b=c(a),d=function(a){return b.render(a)};return d.compiled=b,d}});