/*! jstools-template 2015-05-09 */
!function(a,b){"use strict";if("undefined"!=typeof module)module.exports=b();else if(void 0!==a.define)a.define("$template",b);else if(a.angular){var c=b(a);a.angular.module("jstools.template",[]).provider("$template",function(){this.config=function(a){a.call(null,c)},this.$get=function(){return c}})}else void 0!==a.define?a.define("$template",b):a.$template||(a.$template=b())}(this,function(){"use strict";function a(){}function b(a){return function(b){return b instanceof a}}function c(a){return"string"==typeof a}function d(a){return new Function("model","try{ with(model) { return ("+a+") }; } catch(err) { return ''; }")}function e(a,b){if(!o(b))throw"handler should be a function";if(p(a))a.forEach(b);else if(q(a))for(var c in a)b.apply(null,[a[c],c])}function f(a,b){for(var c in b)a[c]=b[c]}function g(a){a instanceof Object&&f(this,a)}function h(a){if(!c(a))throw"template should be a string";var b=a.split(r),d=[b.shift()];a.replace(s,function(a,c,e,f,g,h){d.push(g?{cmd:"",expression:"/"}:h?{cmd:"",expression:"else"}:{cmd:e,expression:f}),d.push(b.shift())});var e=i(d,"root");return e}function i(a,b,c){b=(b||"").trim(),c=c||"";for(var d={content:[]},e="content",f=function(a){d[a]=[],e=a},g=a.shift();void 0!==g;){if("string"==typeof g)d[e].push(g);else if(q(g))if(g.cmd)if(t[g.cmd]&&t[g.cmd].standalone)d[e].push(new l(g.cmd,g.expression.replace(/\/$/,"")));else switch(g.cmd){case"case":case"when":f(g.expression);break;default:d[e].push("/"===g.expression.substr(-1)?new l(g.cmd,g.expression.replace(/\/$/,"")):i(a,g.cmd,g.expression))}else switch(g.expression){case"else":case"otherwise":f("otherwise");break;case"/":return new l(b,c,d);default:d[e].push(new l("var",g.expression))}g=a.shift()}return new l(b,c,d)}function j(a,b){var d="";return o(b)?b(a):p(b)?(b.forEach(function(e){c(e)?d+=e:e instanceof l?d+=e.render(a):p(e)&&(d+=j(a,b))}),d):b}function k(a){return function(b){return j(b,a)}}function l(b,c,d){this.cmd=b,this.expression=c,this.options={content:a,otherwise:a};for(var e in d)this.options[e]=k(d[e])}function m(a){var b=h(a),c=function(a){return b.render(a)};return c.compiled=b,c}function n(a,b){return void 0===b?a?n.cache[a]:void 0:(c(a)&&c(b)&&(n.cache[a]=m(b),n.cache[a].src=b),n.cache[a])}var o=b(Function),p=b(Array),q=b(Object);g.prototype.$new=function(a){var b=function(a){a instanceof Object&&f(this,a)};return b.prototype=this,new b(a)},g.prototype.$extend=function(a){return f(this,a)},g.prototype.$eval=function(a){return d(a)(this)};var r=/\$[\w\?]*{[^\}]+}|{[\$\/]}|{\:}/,s=/(\$([\w\?]*){([^\}]+)})|({[\$\/]})|({\:})/g,t={root:function(a){return this.content(a)},"var":function(a,b){return a.$eval(b)},"if":function(a,b){return a.$eval(b)?this.content(a):this.otherwise(a)}};t["?"]=t["if"],l.prototype.render=function(a){if(!o(t[this.cmd]))return"[command "+this.cmd+" not found]";var b=a instanceof g?a:new g(a),c=t[this.cmd].apply(this.options,[b,this.expression]),d=j(b,c);return void 0===d?"":d},m.cmd=function(a,b,d){c(a)&&o(b)&&(b.standalone=d,t[a]=b)},n.compile=m,n.cache={},n.cmd=m.cmd,n.helper=m.cmd;var u=/^(.*)(\,(.*))in(.*)$/,v=/^(.*)\bin\b(.*)$/,w=function(a,b,c,d){var f,g=this,h="",i=a.$eval(b);if(p(i))f="$index";else{if(!q(i))return console.warn("can not list",i),"";f="$key"}return e(i,function(b,e){var i={};i[c]=b,i[f]=e,d&&(i[d]=e),h+=g.content(a.$new(i))}),h};return n.cmd("each",function(a,b){var c;if(c=b.match(u))return w.call(this,a,c[4],c[1].trim(),c[3].trim());if(c=b.match(v))return w.call(this,a,c[2],c[1].trim());throw b+" malformed each expression"}),n.cmd("include",function(a,b){var c=n(b.trim());if(c)return c(a);if(c=n(a.$eval(b)))return c(a);throw"partial"+b+"not found"}),n});